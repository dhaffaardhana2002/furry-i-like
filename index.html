<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Image Gallery</title>
</head>
<body>

    <header>
        <h1>Furry... that I like</h1>
        <div class="controls">
            <input type="text" id="githubToken" placeholder="Enter GitHub token">
            <button onclick="loadImages()">Load Images</button>
            <input type="file" id="imageFile" accept="image/*">
            <input type="text" id="imageName" placeholder="Enter image file name">
            <button onclick="uploadImage()">Add Image</button>
        </div>
    </header>

    <div class="gallery-grid">
        <!-- Template -->
        <div class="images" style="display: none;" id="template">
            <img src="" alt="">
            <span></span>
            <button class="delete-btn" onclick="deleteImage(this)">Ã—</button>
        </div>
    </div>

    <style>
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .image-card {
            position: relative;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
        }

        .image-card img {
            width: 100%;
            height: auto;
        }

        .image-card .title {
            margin-top: 10px;
            text-align: center;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            padding: 5px 10px;
            cursor: pointer;
        }

        .controls {
            text-align: center;
            margin: 20px;
        }

        .controls input {
            padding: 8px;
            margin-right: 10px;
            width: 300px;
        }

        .controls button {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .images {
            position: relative;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
        }

        .images img {
            width: 100%;
            height: auto;
        }

        .images span {
            display: block;
            margin-top: 10px;
            text-align: center;
        }
    </style>

    <script>
        const owner = 'dhaffaardhana2002';
        const repo = 'furry-i-like';
        const path = 'img';  // Your images folder path

        async function loadImages() {
            const token = document.getElementById('githubToken').value;
            if (!token) {
                alert('Please enter a GitHub token');
                return;
            }

            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                const data = await response.json();
                
                const gallery = document.querySelector('.gallery-grid');
                const template = document.getElementById('template');
                
                // Clear existing images except template
                Array.from(gallery.children).forEach(child => {
                    if (child !== template) child.remove();
                });

                // Add images
                data.forEach(file => {
                    if (file.type === 'file' && file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
                        const clone = template.cloneNode(true);
                        clone.style.display = 'block';
                        clone.id = '';
                        clone.querySelector('img').src = file.download_url;
                        clone.querySelector('img').alt = file.name;
                        clone.querySelector('span').textContent = file.name;
                        gallery.appendChild(clone);
                    }
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error loading images. Check console for details.');
            }
        }

        async function deleteImage(button) {
            const token = document.getElementById('githubToken').value;
            if (!token) {
                alert('Please enter a GitHub token');
                return;
            }

            const imageCard = button.parentElement;
            const imgElement = imageCard.querySelector('img');
            const fileName = imgElement.alt;

            if (confirm(`Delete ${fileName}?`)) {
                try {
                    // Get file SHA first
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}/${fileName}`, {
                        headers: {
                            'Authorization': `token ${token}`
                        }
                    });
                    const fileData = await response.json();

                    // Delete the file
                    const deleteResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}/${fileName}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            message: `Delete ${fileName}`,
                            sha: fileData.sha,
                            branch: 'master'  // or 'master' depending on your default branch
                        })
                    });

                    if (!deleteResponse.ok) {
                        throw new Error(`HTTP error! status: ${deleteResponse.status}`);
                    }
                    
                    imageCard.remove();
                    alert(`Successfully deleted ${fileName}`);
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error deleting image: ' + error.message);
                }
            }
        }

        async function uploadImage() {
            const token = document.getElementById('githubToken').value;
            const fileInput = document.getElementById('imageFile');
            const fileNameInput = document.getElementById('imageName');
            const file = fileInput.files[0];
            const fileName = fileNameInput.value || file.name;

            if (!token) {
                alert('Please enter a GitHub token');
                return;
            }

            if (!file) {
                alert('Please select an image file to upload');
                return;
            }

            if (!fileName) {
                alert('Please enter a file name or use the original name');
                return;
            }

            try {
                const reader = new FileReader();
                reader.onloadend = async () => {
                    const base64data = reader.result.split(',')[1]; // Get base64 data

                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}/${fileName}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            message: `Add ${fileName}`,
                            content: base64data,
                            branch: 'master'  // Use 'master' branch
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    alert(`Successfully uploaded ${fileName}`);
                    loadImages(); // Reload images after upload
                };

                reader.readAsDataURL(file); // Read the file as a data URL
            } catch (error) {
                console.error('Error:', error);
                alert('Error uploading image: ' + error.message);
            }
        }
    </script>

</body>
</html>